/* 性能优化补丁 - 解决动画性能和字体渲染问题 */

/* 启用硬件加速的全局优化 */
* {
  /* 强制使用 GPU 渲染 */
  -webkit-transform: translateZ(0);
  -moz-transform: translateZ(0);
  -ms-transform: translateZ(0);
  -o-transform: translateZ(0);
  transform: translateZ(0);
  
  /* 启用硬件加速 */
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  
  /* 优化渲染性能 */
  -webkit-perspective: 1000;
  perspective: 1000;
}

/* 重点优化容易出现字体模糊的元素 */
.card,
.btn,
.instance-card,
.section,
.version-stage,
.loading-stage,
.dropdown-content,
.modal,
.alert,
.toast {
  /* 强制硬件加速 */
  will-change: transform;
  transform: translateZ(0);
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  
  /* 字体渲染优化 */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
}

/* 过渡动画优化 */
.transition-all,
.transition-transform,
.transition-colors,
.transition-opacity {
  /* 使用 GPU 加速的过渡 */
  will-change: transform, opacity;
  transform: translateZ(0);
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
}

/* 悬停效果优化 */
[class*="hover:"]:hover,
.hover\:scale-\[1\.02\]:hover,
.hover\:-translate-y-1:hover,
.hover\:shadow-lg:hover {
  /* 防止悬停时字体模糊 */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
  will-change: transform;
  transform: translateZ(0);
}

/* 滚动容器优化 */
.overflow-y-auto,
.overflow-auto,
.instances-list,
.downloads-tab,
.logs-tab {
  /* 启用 GPU 滚动 */
  -webkit-overflow-scrolling: touch;
  will-change: scroll-position;
  
  /* 滚动时的字体优化 */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* 表格性能优化 */
.table,
table {
  /* 启用表格渲染优化 */
  table-layout: fixed;
  border-collapse: collapse;
  
  /* 字体渲染优化 */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
}

/* 输入框优化 */
input,
textarea,
select,
.input,
.textarea,
.select {
  /* 输入时的性能优化 */
  will-change: contents;
  transform: translateZ(0);
  
  /* 字体渲染优化 */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
}

/* 动画元素的特殊优化 */
.animate-spin,
.animate-pulse,
.animate-bounce,
.loading,
.loading-spinner {
  /* 动画性能优化 */
  will-change: transform;
  transform: translateZ(0);
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  
  /* 确保动画期间文字清晰 */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* 图标优化 */
.iconify,
.icon,
svg {
  /* 图标渲染优化 */
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  transform: translateZ(0);
  
  /* 确保图标清晰 */
  shape-rendering: geometricPrecision;
}

/* 主题切换时的优化 */
[data-theme] {
  /* 主题切换时的性能优化 */
  will-change: background-color, color;
  transform: translateZ(0);
}

/* 禁用可能导致性能问题的效果 */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* 高 DPI 屏幕优化 */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
  * {
    /* 高 DPI 屏幕的字体优化 */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  
  /* 高 DPI 屏幕的图标优化 */
  .iconify,
  svg {
    shape-rendering: auto;
  }
}

/* 低端设备优化 */
@media (max-width: 768px) {
  * {
    /* 移动设备性能优化 */
    -webkit-transform: none;
    transform: none;
  }
  
  .card,
  .btn,
  .instance-card {
    /* 移动设备上简化动画 */
    transition-duration: 0.1s;
  }
}

/* 内存优化 */
.hidden,
[style*="display: none"] {
  /* 隐藏元素的性能优化 */
  will-change: auto;
  transform: none;
}

/* 修复特定组件的字体模糊问题 */
.version-selector-container,
.dropdown-stage,
.success-stage {
  /* 版本选择器优化 */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
  transform: translateZ(0);
  will-change: opacity, transform;
}

/* 确保文本在所有情况下都清晰 */
p,
span,
div,
label,
a,
h1, h2, h3, h4, h5, h6 {
  /* 文本渲染优化 */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
}

/* 修复可能的层叠上下文问题 */
.fixed,
.absolute,
.relative {
  /* 定位元素的优化 */
  transform: translateZ(0);
  will-change: transform;
}
